# 웹앱 페이지별 데이터 사용 및 표시 정보

## 📊 공통 데이터 소스

### 메인 데이터
- **파일 경로**: `data_extraction_mlb/results/FINAL_ohtani_data_with_video_analysis.csv`
- **데이터 내용**: Statcast 데이터 + 영상 분석 데이터 + 팔각도 분석 데이터
- **필터링**: 2025년 영상이 있는 데이터만 사용 (중복 제거 후)
- **로드 함수**: `load_video_analysis()` (src/data/video_data.py)

### 주요 컬럼
- **Statcast 데이터**: `game_date`, `pitch_type`, `balls`, `strikes`, `outs_when_up`, `on_1b/2b/3b`, `inning`, `release_speed`, `arm_angle` 등
- **영상 분석 데이터**: `calculated_release_angle`, `calculated_avg_angle`, `release_frame`, `max_wrist_velocity`, `detection_rate`, `output_video_path` 등
- **투구 단계 데이터**: `setup_angle`, `cocking_avg`, `accel_avg`, `decel_avg`, `follow_avg` 등
- **파생 컬럼**: `pitch_type_extracted`, `date_extracted`, `date`, `year`

---

## 1. 🎯 추천 시스템 페이지

### 사용 데이터
1. **ML 모델** (학습 데이터: 전체 Statcast 데이터 2018-2025)
   - `pitch_model_rl.joblib` 또는 `pitch_model.joblib` (구종 추천 모델)
   - `location_model.joblib` (투구 위치 예측 모델)
   - 학습 데이터: `data/raw/csv/shohei_ohtani_pitching_data_2018-03-01_to_2025-11-04.csv` (전체 연도)

2. **영상 데이터** (2025년만)
   - `video_df`: 2025년 영상이 있는 데이터만 필터링된 DataFrame
   - `find_similar_pitches()` 함수로 유사한 과거 투구 검색

### 입력 데이터
- 사용자 입력: `balls`, `strikes`, `outs`, `on_1b/2b/3b`, `inning`, `prev_pitch_type_code`, `is_batter_lefty` 등

### 표시 정보
1. **구종 추천 결과**
   - 1순위 구종: 이름, 확률(%), 목표 위치(X, Z 좌표)
   - 2순위 구종: 이름, 확률(%), 목표 위치(X, Z 좌표)
   - 분석 코멘트: 두 구종의 확률 차이에 따른 전략 제안

2. **멀티 타겟 로케이션 히트맵**
   - 1순위 구종의 목표 위치 (빨간색 히트맵)
   - 2순위 구종의 목표 위치 (파란색 히트맵)
   - 스트라이크 존 시각화

3. **관련 실제 투구 영상**
   - 1순위 구종 예시 영상 (최대 2개)
   - 2순위 구종 예시 영상 (최대 2개)
   - 각 영상 정보: 날짜, 카운트, 아웃 수, 결과 설명
   - 필터링 조건: 구종 + 카운트 + 아웃 + 주자 + 이닝 (유사한 상황)

---

## 2. 📊 분석 홈 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체

### 표시 정보
1. **요약 지표 (4개 메트릭)**
   - 총 분석 투구 수
   - 평균 릴리스 각도 (`calculated_release_angle`)
   - 평균 탐지율 (`detection_rate`)
   - 구종 종류 수 (`pitch_type_extracted`)

2. **릴리스 각도 분포 히스토그램**
   - X축: 릴리스 각도 (°)
   - Y축: 빈도
   - 데이터: `calculated_release_angle` 컬럼

3. **구종별 분포 바 차트**
   - X축: 구종 (FF, ST, CU, SL 등)
   - Y축: 투구 수
   - 데이터: `pitch_type_extracted` 컬럼의 값 개수

---

## 3. 📈 전체 통계 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체

### 표시 정보
1. **주요 지표 통계 테이블**
   - 컬럼: `calculated_release_angle`, `calculated_avg_angle`, `release_frame`, `max_wrist_velocity`, `detection_rate`, `angle_range`
   - 통계: count, mean, std, min, 25%, 50%, 75%, max
   - 형식: pandas `describe()` 결과

2. **변수 간 상관관계 히트맵**
   - 주요 지표 컬럼들 간의 상관계수
   - 색상: coolwarm (빨강=양의 상관, 파랑=음의 상관)
   - 수치: 각 셀에 상관계수 표시

---

## 4. 🎯 구종별 분석 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체
- 사용자 선택: 구종 다중 선택 (multiselect)

### 표시 정보
1. **구종별 통계 테이블**
   - 그룹화: `pitch_type_extracted` 기준
   - 통계: `calculated_release_angle` (mean, std, count), `calculated_avg_angle` (mean), `max_wrist_velocity` (mean), `detection_rate` (mean)
   - 형식: 그룹별 집계 결과

2. **구종별 릴리스 각도 비교 박스플롯**
   - X축: 구종
   - Y축: 릴리스 각도 (°)
   - 데이터: 선택된 구종별 `calculated_release_angle` 분포
   - 시각화: 박스플롯 (중앙값, 사분위수, 이상치)

---

## 5. 🔄 투구 단계 분석 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체

### 표시 정보
1. **투구 단계별 각도 분포 박스플롯**
   - 단계: 준비 단계 (`setup_angle`), 코킹 단계 (`cocking_avg`), 가속 단계 (`accel_avg`), 감속 단계 (`decel_avg`), 팔로스루 단계 (`follow_avg`)
   - X축: 투구 단계
   - Y축: 각도 (°)
   - 데이터: 각 단계별 각도 분포

2. **단계별 통계 테이블**
   - 컬럼: 단계명, 평균 각도, 중앙값, 표준편차, 샘플 수
   - 데이터: 각 단계별 각도 통계 요약

---

## 6. 📅 시간 경향성 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체
- 필터링: `date` 컬럼이 있는 데이터만

### 표시 정보
1. **시간에 따른 릴리스 각도 추이 라인 차트**
   - X축: 날짜 (`date`)
   - Y축: 평균 릴리스 각도 (`calculated_release_angle`)
   - 데이터: 날짜별 그룹화 후 평균 계산
   - 시각화: Plotly 라인 차트 (인터랙티브)
   - 정렬: 날짜 오름차순

---

## 7. 🎬 동영상 탐색 페이지

### 사용 데이터
- `video_df`: 2025년 영상 데이터 전체
- 사용자 필터: 구종 선택, 릴리스 각도 범위 슬라이더

### 표시 정보
1. **검색 결과 테이블**
   - 컬럼: `game_pk`, `at_bat_number`, `pitch_number`, `pitch_type_extracted`, `calculated_release_angle`, `calculated_avg_angle`, `detection_rate`
   - 필터링: 구종 + 릴리스 각도 범위
   - 표시: 최대 100개 행

2. **상세 정보 섹션**
   - 기본 정보: `game_pk`, `at_bat_number`, `pitch_number`, `pitch_type_extracted`
   - 분석 결과: `calculated_release_angle`, `calculated_avg_angle`, `detection_rate`
   - 동영상: `output_video_path` 경로의 영상 재생
   - 선택: 드롭다운으로 특정 투구 선택

---

## 📝 데이터 흐름 요약

```
1. 데이터 로드
   └─> FINAL_ohtani_data_with_video_analysis.csv
       └─> 2025년 필터링 + 중복 제거
           └─> video_df (2025년 영상 데이터)

2. 추천 시스템
   └─> ML 모델 (전체 연도 Statcast 데이터로 학습)
       └─> 구종 추천 + 위치 예측
           └─> video_df에서 유사한 과거 투구 검색
               └─> 영상 표시

3. 분석 페이지들
   └─> video_df (2025년 영상 데이터)
       └─> 각 페이지별 통계/시각화
```

---

## 🔑 주요 특징

1. **데이터 분리**
   - **ML 모델 학습**: 전체 연도 Statcast 데이터 (2018-2025)
   - **영상 표시**: 2025년 영상 데이터만

2. **데이터 필터링**
   - 2025년 `game_date` 필터링
   - `output_video_path`가 있는 데이터만
   - 중복 제거 (`game_pk`, `at_bat_number`, `pitch_number`)

3. **데이터 변환**
   - 상대 경로 → 절대 경로 변환
   - 날짜 파싱 및 구종 추출
   - 타입 변환 (int, datetime 등)

